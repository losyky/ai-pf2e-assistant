{{!-- 物品储存箱模板 - 使用PF2e原生导航样式 --}}
<form class="{{cssClass}} crb-style">
  {{!-- 顶部Header - 显示角色名称的储存箱 --}}
  <header class="storage-char-header" data-tooltip-direction="UP">
    <h1>{{actor.name}}的储存箱</h1>
  </header>

  {{!-- PF2e风格的圆形图标导航 --}}
  <nav class="sheet-navigation" data-group="storage" data-tooltip-direction="UP" role="tablist">
    <a class="item {{#if (eq currentTab 'feats')}}active{{/if}}" data-action="switch-tab" data-tab="feats" data-tooltip="专长 ({{featTotalCount}})" role="tab" aria-label="专长">
      <i class="fa-solid fa-medal"></i>
    </a>
    
    <a class="item {{#if (eq currentTab 'spells')}}active{{/if}}" data-action="switch-tab" data-tab="spells" data-tooltip="法术 ({{spellTotalCount}})" role="tab" aria-label="法术">
      <i class="fa-solid fa-wand-magic-sparkles"></i>
    </a>
    
    <a class="item {{#if (eq currentTab 'fragments')}}active{{/if}}" data-action="switch-tab" data-tab="fragments" data-tooltip="碎片物品 ({{fragmentTotalCount}})" role="tab" aria-label="碎片物品">
      <i class="fa-solid fa-gem"></i>
    </a>
  </nav>

  <section class="sheet-body">
    {{!-- 专长分页内容 --}}
    {{#if (eq currentTab 'feats')}}
      {{#if hasAnyFeats}}
        {{!-- 普通存储区 --}}
        <section class="feat-section item-storage-section storage-unconfirmed" data-storage-area="unconfirmed">
          <header>
            <h3>
              <i class="fa-solid fa-box"></i> 普通存储区
              <span class="section-hint">（合成后的专长会先进入此区域）</span>
            </h3>
          </header>
          {{#if unconfirmedFeats}}
            <ol class="feats-list">
              {{#each unconfirmedFeats as |feat|}}
                <li class="slot" data-item-id="{{feat.id}}" data-item-type="feat" data-confirmed="false" draggable="true">
                  <div class="item-name drag-handle" data-drag-handle>
                    <a class="item-image framed" data-action="item-to-chat">
                      <img class="item-icon" src="{{feat.img}}" alt="{{feat.name}}">
                      <i class="fa-solid fa-message"></i>
                    </a>
                    <h4 class="name"><a data-action="toggle-summary">{{feat.name}}</a></h4>
                  </div>
                  <div class="item-controls">
                    {{#if @root.editable}}
                      <a data-action="edit-item" data-tooltip="查看详情"><i class="fa-solid fa-fw fa-eye"></i></a>
                      <a data-action="delete-item" data-tooltip="删除专长"><i class="fa-solid fa-fw fa-trash"></i></a>
                    {{/if}}
                  </div>
                  <div class="item-summary" hidden></div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <div class="area-empty">
              <i class="fa-solid fa-inbox"></i>
              <p>普通存储区为空。合成专长后会自动进入此区域。</p>
            </div>
          {{/if}}
          
          {{!-- 清除按钮放在普通存储区底部 --}}
          {{#if hasUnconfirmedFeats}}
            <div class="section-footer">
              <button type="button" class="clear-unconfirmed-button" data-action="clear-unconfirmed" data-tooltip="删除所有普通区（未确认）的专长">
                <i class="fa-solid fa-broom"></i> 一键清除普通区
              </button>
            </div>
          {{/if}}
        </section>

        {{!-- 确认存储区 --}}
        <section class="feat-section item-storage-section storage-confirmed" data-storage-area="confirmed">
          <header>
            <h3>
              <i class="fa-solid fa-check-circle"></i> 确认存储区
              <span class="section-hint">（拖入此区域的专长不会被一键清除）</span>
            </h3>
          </header>
          {{#if confirmedFeats}}
            <ol class="feats-list">
              {{#each confirmedFeats as |feat|}}
                <li class="slot" data-item-id="{{feat.id}}" data-item-type="feat" data-confirmed="true" draggable="true">
                  <div class="item-name drag-handle" data-drag-handle>
                    <a class="item-image framed" data-action="item-to-chat">
                      <img class="item-icon" src="{{feat.img}}" alt="{{feat.name}}">
                      <i class="fa-solid fa-message"></i>
                    </a>
                    <h4 class="name"><a data-action="toggle-summary">{{feat.name}}</a></h4>
                  </div>
                  <div class="item-controls">
                    {{#if @root.editable}}
                      <a data-action="edit-item" data-tooltip="查看详情"><i class="fa-solid fa-fw fa-eye"></i></a>
                      <a data-action="delete-item" data-tooltip="删除专长"><i class="fa-solid fa-fw fa-trash"></i></a>
                    {{/if}}
                  </div>
                  <div class="item-summary" hidden></div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <div class="area-empty">
              <i class="fa-solid fa-inbox"></i>
              <p>确认存储区为空。将重要专长拖入此区域，它们不会被一键清除。</p>
            </div>
          {{/if}}
        </section>
        
        {{!-- 存储统计信息放在最底部 --}}
        <div class="storage-summary">
          <i class="fa-solid fa-chart-simple"></i>
          <span>专长: <strong>{{totalCount}}</strong> (普通: <strong>{{unconfirmedCount}}</strong> / 确认: <strong>{{confirmedCount}}</strong>)</span>
        </div>
      {{else}}
        <div class="storage-empty">
          <div class="empty-icon">
            <i class="fa-solid fa-box-open"></i>
          </div>
          <h3>储存箱是空的</h3>
          <p>通过神龛合成专长后，它们会自动存储在这里。</p>
          <p>您也可以将角色卡上的专长拖入此处进行储存。</p>
          <div class="empty-hint">
            <i class="fa-solid fa-info-circle"></i>
            储存的专长不会激活规则元素，拖出到角色卡后才会生效。
          </div>
        </div>
      {{/if}}
    {{/if}}

    {{!-- 法术分页内容 --}}
    {{#if (eq currentTab 'spells')}}
      {{#if hasAnySpells}}
        {{!-- 普通存储区 --}}
        <section class="spell-section item-storage-section storage-unconfirmed" data-storage-area="unconfirmed">
          <header>
            <h3>
              <i class="fa-solid fa-box"></i> 普通存储区
              <span class="section-hint">（合成后的法术会先进入此区域）</span>
            </h3>
          </header>
          {{#if unconfirmedSpells}}
            <ol class="spells-list">
              {{#each unconfirmedSpells as |spell|}}
                <li class="slot" data-item-id="{{spell.id}}" data-item-type="spell" data-confirmed="false" draggable="true">
                  <div class="item-name drag-handle" data-drag-handle>
                    <a class="item-image framed" data-action="item-to-chat">
                      <img class="item-icon" src="{{spell.img}}" alt="{{spell.name}}">
                      <i class="fa-solid fa-message"></i>
                    </a>
                    <h4 class="name"><a data-action="toggle-summary">{{spell.name}}</a></h4>
                  </div>
                  <div class="item-controls">
                    {{#if @root.editable}}
                      <a data-action="edit-item" data-tooltip="查看详情"><i class="fa-solid fa-fw fa-eye"></i></a>
                      <a data-action="delete-item" data-tooltip="删除法术"><i class="fa-solid fa-fw fa-trash"></i></a>
                    {{/if}}
                  </div>
                  <div class="item-summary" hidden></div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <div class="area-empty">
              <i class="fa-solid fa-inbox"></i>
              <p>普通存储区为空。合成法术后会自动进入此区域。</p>
            </div>
          {{/if}}
          
          {{!-- 清除按钮放在普通存储区底部 --}}
          {{#if hasUnconfirmedSpells}}
            <div class="section-footer">
              <button type="button" class="clear-unconfirmed-button" data-action="clear-unconfirmed" data-tooltip="删除所有普通区（未确认）的法术">
                <i class="fa-solid fa-broom"></i> 一键清除普通区
              </button>
            </div>
          {{/if}}
        </section>

        {{!-- 确认存储区 --}}
        <section class="spell-section item-storage-section storage-confirmed" data-storage-area="confirmed">
          <header>
            <h3>
              <i class="fa-solid fa-check-circle"></i> 确认存储区
              <span class="section-hint">（拖入此区域的法术不会被一键清除）</span>
            </h3>
          </header>
          {{#if confirmedSpells}}
            <ol class="spells-list">
              {{#each confirmedSpells as |spell|}}
                <li class="slot" data-item-id="{{spell.id}}" data-item-type="spell" data-confirmed="true" draggable="true">
                  <div class="item-name drag-handle" data-drag-handle>
                    <a class="item-image framed" data-action="item-to-chat">
                      <img class="item-icon" src="{{spell.img}}" alt="{{spell.name}}">
                      <i class="fa-solid fa-message"></i>
                    </a>
                    <h4 class="name"><a data-action="toggle-summary">{{spell.name}}</a></h4>
                  </div>
                  <div class="item-controls">
                    {{#if @root.editable}}
                      <a data-action="edit-item" data-tooltip="查看详情"><i class="fa-solid fa-fw fa-eye"></i></a>
                      <a data-action="delete-item" data-tooltip="删除法术"><i class="fa-solid fa-fw fa-trash"></i></a>
                    {{/if}}
                  </div>
                  <div class="item-summary" hidden></div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <div class="area-empty">
              <i class="fa-solid fa-inbox"></i>
              <p>确认存储区为空。将重要法术拖入此区域，它们不会被一键清除。</p>
            </div>
          {{/if}}
        </section>
        
        {{!-- 存储统计信息放在最底部 --}}
        <div class="storage-summary">
          <i class="fa-solid fa-chart-simple"></i>
          <span>法术: <strong>{{totalCount}}</strong> (普通: <strong>{{unconfirmedCount}}</strong> / 确认: <strong>{{confirmedCount}}</strong>)</span>
        </div>
      {{else}}
        <div class="storage-empty">
          <div class="empty-icon">
            <i class="fa-solid fa-box-open"></i>
          </div>
          <h3>储存箱是空的</h3>
          <p>通过神龛合成法术后，它们会自动存储在这里。</p>
          <p>您也可以将角色卡上的法术拖入此处进行储存。</p>
          <div class="empty-hint">
            <i class="fa-solid fa-info-circle"></i>
            储存的法术不会激活规则元素，拖出到角色卡后才会生效。
          </div>
        </div>
      {{/if}}
    {{/if}}

    {{!-- 碎片物品分页内容 --}}
    {{#if (eq currentTab 'fragments')}}
      {{#if hasAnyFragments}}
        {{!-- 普通存储区 --}}
        <section class="fragment-section item-storage-section storage-unconfirmed" data-storage-area="unconfirmed">
          <header>
            <h3>
              <i class="fa-solid fa-box"></i> 普通存储区
              <span class="section-hint">（添加的碎片物品会先进入此区域）</span>
            </h3>
          </header>
          {{#if unconfirmedFragments}}
            <ol class="fragments-list">
              {{#each unconfirmedFragments as |fragment|}}
                <li class="slot" data-item-id="{{fragment.id}}" data-item-type="equipment" data-confirmed="false" draggable="true">
                  <div class="item-name drag-handle" data-drag-handle>
                    <a class="item-image framed" data-action="item-to-chat">
                      <img class="item-icon" src="{{fragment.img}}" alt="{{fragment.name}}">
                      <i class="fa-solid fa-message"></i>
                    </a>
                    <h4 class="name"><a data-action="toggle-summary">{{fragment.name}}</a></h4>
                  </div>
                  <div class="item-controls">
                    {{#if @root.editable}}
                      <a data-action="edit-item" data-tooltip="查看详情"><i class="fa-solid fa-fw fa-eye"></i></a>
                      <a data-action="delete-item" data-tooltip="删除碎片物品"><i class="fa-solid fa-fw fa-trash"></i></a>
                    {{/if}}
                  </div>
                  <div class="item-summary" hidden></div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <div class="area-empty">
              <i class="fa-solid fa-inbox"></i>
              <p>普通存储区为空。将碎片物品拖入此区域进行储存。</p>
            </div>
          {{/if}}
          
          {{!-- 清除按钮放在普通存储区底部 --}}
          {{#if hasUnconfirmedFragments}}
            <div class="section-footer">
              <button type="button" class="clear-unconfirmed-button" data-action="clear-unconfirmed" data-tooltip="删除所有普通区（未确认）的碎片物品">
                <i class="fa-solid fa-broom"></i> 一键清除普通区
              </button>
            </div>
          {{/if}}
        </section>

        {{!-- 确认存储区 --}}
        <section class="fragment-section item-storage-section storage-confirmed" data-storage-area="confirmed">
          <header>
            <h3>
              <i class="fa-solid fa-check-circle"></i> 确认存储区
              <span class="section-hint">（拖入此区域的碎片物品不会被一键清除）</span>
            </h3>
          </header>
          {{#if confirmedFragments}}
            <ol class="fragments-list">
              {{#each confirmedFragments as |fragment|}}
                <li class="slot" data-item-id="{{fragment.id}}" data-item-type="equipment" data-confirmed="true" draggable="true">
                  <div class="item-name drag-handle" data-drag-handle>
                    <a class="item-image framed" data-action="item-to-chat">
                      <img class="item-icon" src="{{fragment.img}}" alt="{{fragment.name}}">
                      <i class="fa-solid fa-message"></i>
                    </a>
                    <h4 class="name"><a data-action="toggle-summary">{{fragment.name}}</a></h4>
                  </div>
                  <div class="item-controls">
                    {{#if @root.editable}}
                      <a data-action="edit-item" data-tooltip="查看详情"><i class="fa-solid fa-fw fa-eye"></i></a>
                      <a data-action="delete-item" data-tooltip="删除碎片物品"><i class="fa-solid fa-fw fa-trash"></i></a>
                    {{/if}}
                  </div>
                  <div class="item-summary" hidden></div>
                </li>
              {{/each}}
            </ol>
          {{else}}
            <div class="area-empty">
              <i class="fa-solid fa-inbox"></i>
              <p>确认存储区为空。将重要碎片物品拖入此区域，它们不会被一键清除。</p>
            </div>
          {{/if}}
        </section>
        
        {{!-- 存储统计信息放在最底部 --}}
        <div class="storage-summary">
          <i class="fa-solid fa-chart-simple"></i>
          <span>碎片物品: <strong>{{totalCount}}</strong> (普通: <strong>{{unconfirmedCount}}</strong> / 确认: <strong>{{confirmedCount}}</strong>)</span>
        </div>
      {{else}}
        <div class="storage-empty">
          <div class="empty-icon">
            <i class="fa-solid fa-box-open"></i>
          </div>
          <h3>储存箱是空的</h3>
          <p>您可以将角色卡上的碎片物品拖入此处进行储存。</p>
          <div class="empty-hint">
            <i class="fa-solid fa-info-circle"></i>
            储存的碎片物品不会激活规则元素，拖出到角色卡后才会生效。
          </div>
        </div>
      {{/if}}
    {{/if}}
  </section>
</form>
